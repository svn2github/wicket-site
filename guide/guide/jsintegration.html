<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>16 An example of integration with JavaScript 6.x</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/howToSource.html"><strong>2</strong><span>How to use the example code</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/whyLearn.html"><strong>3</strong><span>Why should I learn Wicket?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helloWorld.html"><strong>4</strong><span>Wicket says &ldquo;Hello world!&rdquo;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/layout.html"><strong>5</strong><span>Wicket as page layout manager</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/keepControl.html"><strong>6</strong><span>Keeping control over HTML</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/componentLifecycle.html"><strong>7</strong><span>Components lifecycle</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/versioningCaching.html"><strong>8</strong><span>Page versioning and caching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestProcessing.html"><strong>9</strong><span>Under the hood of the request processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/modelsforms.html"><strong>11</strong><span>Wicket models and forms</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/forms2.html"><strong>12</strong><span>Wicket forms in detail</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>14</strong><span>Internationalization with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/jsintegration.html"><strong>16</strong><span>An example of integration with JavaScript</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ajax.html"><strong>18</strong><span>Working with AJAX</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/jee.html"><strong>19</strong><span>Integration with enterprise containers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/nativewebsockets.html"><strong>20</strong><span>Native WebSockets</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>21</strong><span>Security with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/testing.html"><strong>22</strong><span>Test Driven Development with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/bestpractices.html"><strong>24</strong><span>Wicket Best Practices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/internals.html"><strong>25</strong><span>Wicket Internals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/maven.html"><strong>26</strong><span>Working with Maven (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/wicketstuff.html"><strong>27</strong><span>Project WicketStuff (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/redirects.html"><strong>28</strong><span>Lost In Redirection With Apache Wicket (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/contributing.html"><strong>29</strong><span>Contributing to this guide (Appendix)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="/" target="_blank"><img height="80px" src="http://wicket.apache.org/guide/img/apache-wicket.png"/></a></span>
        
        
        <span id="sponsor"><a href="http://www.apache.org/" target="_blank"><img height="60px" src="http://wicket.apache.org/guide/img/asf_logo.gif"/></a></span>
        
    </div>
    <p>Free Online Guide for Apache Wicket framework</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/resources.html">&lt;&lt; <strong>15</strong><span>Resource management with Wicket</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span> >></a></div>
                


                <div class="project">
                    <h1>16 An example of integration with JavaScript - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Andrea Del Bene, Martin Grigorov, Carsten Hufe, Christian Kroemer, Daniel Bartl, Paul Bor»ô</p>

                    <p><strong>Version:</strong> 6.x</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jsintegration_1"><strong>16.1</strong><span>What we want to do...</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jsintegration_2"><strong>16.2</strong><span>...and how we will do it</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jsintegration_3"><strong>16.3</strong><span>Summary</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="jsintegration">16 An example of integration with JavaScript</h1>
It's time to put into practice what we have learnt so far in this guide. To do this we will build a custom date component consisting of a text field to edit a date value and a fancy calendar icon to open a JavaScript datepicker. This chapter will also illustrate an example of integration of Wicket with a JavaScript library like <a href="http://jquery.com/" target="blank">JQuery</a> and its child project <a href="http://jqueryui.com/" target="blank">JQuery UI</a> .


<h2 id="jsintegration_1">16.1 What we want to do...</h2>
<p class="paragraph"/>For end-users a datepicker is one of the most appreciated widget. It allows to simply edit a date value with the help of a user-friendly pop-up calendar. That's why nearly all UI frameworks provide a version of this widget.<p class="paragraph"/>Popular JavaScript libraries like YUI and JQuery come with a ready-to-use datepicker to enrich the user experience of our web applications. Wicket already provides a component which integrates a text field with a calendar widget from YUI library, but there is no built-in component that uses a datepicker based on JQuery library.<p class="paragraph"/>As both JQuery and its child project JQueryUI have gained a huge popularity in the last years, it's quite interesting to see how to integrate them in Wicket building a custom component. In this chapter we will create a custom datepicker based on the corresponding widget from JQueryUI project:<p class="paragraph"/><img border="0" class="center" src="../img/datepicker-screenshot.png"></img><p class="paragraph"/><blockquote class="warning">
On Internet you can find different libraries that already offer a strong integration between Wicket and JQuery. The goal of this chapter is to see how to integrate Wicket with a JavaScript framework building a simple homemade datepicker which is not intended to provide every feature of the original JavaScript widget.
</blockquote><p class="paragraph"/><h3>What features we want to implement</h3><p class="paragraph"/>Before starting to write code, we must clearly define what features we want to implement for our component. The new component should:
<ul class="star">
<li><strong class="bold">Be self-contained</strong>: we must be able to distribute it and use it in other projects without requiring any kind of additional configuration.</li>
<li><strong class="bold">Have a customizable date format</strong>: developer must be able to decide the date format used to display date value and to parse user input.</li>
<li><strong class="bold">Be localizable</strong>: the pop-up calendar must be localizable in order to support different languages.</li>
</ul><p class="paragraph"/>That's what we'd like to have with our custom datepicker. In the rest of the chapter we will see how to implement the features listed above and which resources must be packaged with our component.


<h2 id="jsintegration_2">16.2 ...and how we will do it</h2>
<p class="paragraph"/>Our new component will extend the a built-in text field <code>org.apache.wicket.extensions.markup.html.form.DateTextField</code> which already uses a java.util.Date as model object and already performs conversion and validation for input values. Since the component must be self-contained, we must ensure that the JavaScript libraries it relies on (JQuery and JQuery UI) will be always available.<p class="paragraph"/>Starting from version 6.0 Wicket has adopted JQuery as backing JavaScript library so we can use the  version bundled with Wicket for our custom datepicker.<p class="paragraph"/>To make JQuery UI available we should instead go to its official site, download the required artifacts and use them as package resources of our component.<p class="paragraph"/><h3>Component package resources</h3><p class="paragraph"/>JQuery UI needs the following static resources in order to work properly:
<ul class="star">
<li><strong class="bold">jquery-ui.min.js</strong>: the minified version of the library.</li>
<li><strong class="bold">jquery-ui.css</strong>: the CSS containing the style used by JQuery UI widgets.</li>
<li><strong class="bold">jquery-ui-i18n.min.js</strong>: the minified JavaScript containing the built-in support for localization.</li>
<li><strong class="bold">Folder 'images'</strong>: the folder containing picture files used by JQuery UI widgets.</li>
</ul><p class="paragraph"/>In the following picture we can see these package resources with our component class (named JQueryDateField):<p class="paragraph"/><img border="0" class="center" src="../img/datepicker-package-resources.png"></img><p class="paragraph"/>Along with the four static resources listed above, we can find also file calendar.jpg, which is the calendar icon used to open the pop up calendar, and file JQDatePicker.js which contains the following custom JavaScript code that binds our component to a JQuery UI datepicker:<p class="paragraph"/><div class="code"><pre>function initJQDatepicker(inputId, countryIsoCode, dateFormat,  calendarIcon) &#123;
	<span class="java&#45;keyword">var</span> localizedArray = $.datepicker.regional&#91;countryIsoCode&#93;;
	localizedArray&#91;'buttonImage'&#93; = calendarIcon;
	localizedArray&#91;'dateFormat'&#93; = dateFormat;
	initCalendar(localizedArray);
	$(<span class="java&#45;quote">"&#35;"</span> + inputId).datepicker(localizedArray);	
&#125;;<p class="paragraph"/>function initCalendar(localizedArray)&#123;
	 localizedArray&#91;'changeMonth'&#93;= <span class="java&#45;keyword">true</span>;
	 localizedArray&#91;'changeYear'&#93;= <span class="java&#45;keyword">true</span>;
	 localizedArray&#91;'showOn'&#93; = 'button';
	 localizedArray&#91;'buttonImageOnly'&#93; = <span class="java&#45;keyword">true</span>;
&#125;;</pre></div><p class="paragraph"/>Function initJQDatepicker takes in input the following parameters:
<ul class="star">
<li><strong class="bold">inputId</strong>: the id of the HTML text field corresponding to our custom component instance.</li>
<li><strong class="bold">countryIsoCode</strong>: a two-letter low-case ISO language code. It can contain also the two-letter upper-case ISO country code separated with a minus sign (for example en-GB)</li>
<li><strong class="bold">dateFormat</strong>: the date format to use for parsing and displaying date values.</li>
<li><strong class="bold">calendarIcon</strong>: the relative URL of the icon used as calendar icon.</li>
</ul><p class="paragraph"/>As we will see in the next paragraphs, its up to our component to generate this parameters and invoke the initJQDatepicker function.<p class="paragraph"/>Function initCalendar is a simple utility function that sets the initialization array for datepicker widget. For more details on JQuery UI datepicker usage see the documentation at http://jqueryui.com/ datepicker.<p class="paragraph"/><h3>Initialization code</h3><p class="paragraph"/>The initialization code for our component is contained inside its method onInitialize and is the following:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">protected</span> void onInitialize() &#123;
	<span class="java&#45;keyword">super</span>.onInitialize();
	setOutputMarkupId(<span class="java&#45;keyword">true</span>);<p class="paragraph"/>	datePattern =  <span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"jqueryDateField.shortDatePattern"</span>, <span class="java&#45;quote">"mm/dd/yy"</span>)
                                          .getObject();		
	countryIsoCode = <span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"jqueryDateField.countryIsoCode"</span>, <span class="java&#45;quote">"en&#45;GB"</span>)                                                             
                                          .getObject();<p class="paragraph"/>	PackageResourceReference resourceReference = 
                            <span class="java&#45;keyword">new</span> PackageResourceReference(getClass(), <span class="java&#45;quote">"calendar.jpg"</span>);<p class="paragraph"/>	urlForIcon = urlFor(resourceReference, <span class="java&#45;keyword">new</span> PageParameters());
	dateConverter = <span class="java&#45;keyword">new</span> PatternDateConverter(datePattern, <span class="java&#45;keyword">false</span>);	
&#125;<p class="paragraph"/>@Override
<span class="java&#45;keyword">public</span> &#60;Date&#62; IConverter&#60;Date&#62; getConverter(<span class="java&#45;object">Class</span>&#60;Date&#62; type) &#123;
	<span class="java&#45;keyword">return</span> (IConverter&#60;Date&#62;) dateConverter;
&#125;</pre></div><p class="paragraph"/>The first thing to do inside onInitialize is to ensure that our component will have a markup id for its related text field. This is done invoking setOutputMarkupId(true).<p class="paragraph"/>Next, JQueryDateField tries to retrieve the date format and the ISO language code that must be used as initialization parameters. This is done using class <code>ResourceModel</code> which searches for a given resource in the available bundles. If no value is found for date format or for ISO language code, default values will be used ('mm/dd/yy' and 'en-GB').<p class="paragraph"/>To generate the relative URL for calendar icon, we load it as package resource reference and then we use <code>Component</code>'s method urlFor to get the URL value (we have seen this method in paragraph 7.3.2).<p class="paragraph"/>The last configuration instruction executed inside onInitialize is the instantiation of the custom converter used by our component. This converter is an instance of the built-in class <code>org.apache.wicket.datetime.PatternDateConvert</code> and must use the previously retrieved date format to perform conversion operations. Now to tell our component to use this converter we must return it overriding <code>FormComponent</code>'s method <code>getConverter</code>.<p class="paragraph"/><h3>Header contributor code</h3><p class="paragraph"/>The rest of the code of our custom component is inside method <code>renderHeader</code>, which is responsible for adding to page header the bundled JQuery library, the three files from JQuery UI distribution, the custom file JQDatePicker.js and the invocation of function <code>initJQDatepicker</code>:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">public</span> void renderHead(IHeaderResponse response) &#123;
	<span class="java&#45;keyword">super</span>.renderHead(response);<p class="paragraph"/>	//<span class="java&#45;keyword">if</span> component is disabled we don't have to load the JQueryUI datepicker
	<span class="java&#45;keyword">if</span>(!isEnabledInHierarchy())
		<span class="java&#45;keyword">return</span>;
	//add bundled JQuery
	IJavaScriptLibrarySettings javaScriptSettings =          
                      getApplication().getJavaScriptLibrarySettings();
	response.render(JavaScriptHeaderItem.
			forReference(javaScriptSettings.getJQueryReference()));
	//add <span class="java&#45;keyword">package</span> resources
	response.render(JavaScriptHeaderItem.
	      forReference(<span class="java&#45;keyword">new</span> PackageResourceReference(getClass(), <span class="java&#45;quote">"jquery&#45;ui.min.js"</span>)));
	response.render(JavaScriptHeaderItem.
	      forReference(<span class="java&#45;keyword">new</span> PackageResourceReference(getClass(), <span class="java&#45;quote">"jquery&#45;ui&#45;i18n.min.js"</span>)));
	response.render(CssHeaderItem.
	      forReference(<span class="java&#45;keyword">new</span> PackageResourceReference(getClass(), <span class="java&#45;quote">"jquery&#45;ui.css"</span>)));
	//add custom file JQDatePicker.js. Reference JQDatePickerRef is a <span class="java&#45;keyword">static</span> field
	response.render(JavaScriptHeaderItem.forReference(JQDatePickerRef));<p class="paragraph"/>	//add the init script <span class="java&#45;keyword">for</span> datepicker
	<span class="java&#45;object">String</span> jqueryDateFormat = datePattern.replace(<span class="java&#45;quote">"yyyy"</span>, <span class="java&#45;quote">"yy"</span>).toLowerCase();
	<span class="java&#45;object">String</span> initScript = <span class="java&#45;quote">";initJQDatepicker('"</span> + getMarkupId() + <span class="java&#45;quote">"', '"</span> + countryIsoCode +
                            <span class="java&#45;quote">"', '"</span> + jqueryDateFormat + <span class="java&#45;quote">"', "</span> + <span class="java&#45;quote">"'"</span> + urlForIcon +<span class="java&#45;quote">"');"</span>;
	response.render(OnLoadHeaderItem.forScript(initScript));
&#125;</pre></div><p class="paragraph"/>If component is disabled the calendar icon must be hidden and no datepicker must be displayed. That's why <code>renderHeader</code> is skipped if component is not enabled.<p class="paragraph"/>To get a reference to the bundled JQuery library we used the JavaScript setting interface <code>IJavaScriptLibrarySettings</code> and its method <code>getJQueryReference</code>.<p class="paragraph"/>In the last part of <code>renderHeader</code> we build the string to invoke function <code>initJQDatepicker</code> using the values obtained inside onInitialize. Unfortunately the date format used by JQuery UI is different from the one adopted in Java so we have to convert it before building the JavaScript code. This init script is rendered into header section using a <code>OnLoadHeaderItem</code> to ensure that it will be executed after all the other scripts have been loaded.<p class="paragraph"/><blockquote class="note">
If we add more than one instance of our custom component to a single page, static resources are rendered to the header section just once. Wicket automatically checks if a static resource is already referenced by a page and if so, it will not render it again.<p class="paragraph"/>This does not apply to the init script which is dynamically generated and is rendered for every instance of the component.
</blockquote><p class="paragraph"/><blockquote class="warning">
Our datepicker is not ready yet to be used with AJAX. In chapter 16 we will see how to modify it to make it AJAX-compatible.
</blockquote>


<h2 id="jsintegration_3">16.3 Summary</h2>
<p class="paragraph"/>In this brief chapter we have seen how custom components can be integrated with <a href="http://en.wikipedia.org/wiki/Dynamic_HTML" target="blank">DHTML</a> technologies. To do so we have used most of what we have learnt in this guide. Now we are able to build complex components with a rich user experience. However this is not enough yet to develop <a href="http://en.wikipedia.org/wiki/Web_2.0" target="blank">Web 2.0</a> applications. We still have to cover a fundamental technology like AJAX and some other Wicket-related topics that will help us building our application in more modular and efficient way.<p class="paragraph"/><p class="paragraph"/>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/resources.html">&lt;&lt; <strong>15</strong><span>Resource management with Wicket</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
Copyright &copy; 2013-2014 ‚Äî <a href="http://www.apache.org/" target="_blank">The Apache Software Foundation</a> 
                      ‚Äî <b style="color:#E8590A !important;">(Generated on: 2015-02-03)</b>

    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
