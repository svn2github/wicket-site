<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>22.1 Utility class WicketTester 6.x</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/howToSource.html"><strong>2</strong><span>How to use the example code</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/whyLearn.html"><strong>3</strong><span>Why should I learn Wicket?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/helloWorld.html"><strong>4</strong><span>Wicket says &ldquo;Hello world!&rdquo;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/layout.html"><strong>5</strong><span>Wicket as page layout manager</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/keepControl.html"><strong>6</strong><span>Keeping control over HTML</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/componentLifecycle.html"><strong>7</strong><span>Components lifecycle</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/versioningCaching.html"><strong>8</strong><span>Page versioning and caching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/requestProcessing.html"><strong>9</strong><span>Under the hood of the request processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/modelsforms.html"><strong>11</strong><span>Wicket models and forms</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/forms2.html"><strong>12</strong><span>Wicket forms in detail</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>14</strong><span>Internationalization with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jsintegration.html"><strong>16</strong><span>An example of integration with JavaScript</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/ajax.html"><strong>18</strong><span>Working with AJAX</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jee.html"><strong>19</strong><span>Integration with enterprise containers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/nativewebsockets.html"><strong>20</strong><span>Native WebSockets</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>21</strong><span>Security with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>22</strong><span>Test Driven Development with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/bestpractices.html"><strong>24</strong><span>Wicket Best Practices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/internals.html"><strong>25</strong><span>Wicket Internals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/maven.html"><strong>26</strong><span>Working with Maven (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/wicketstuff.html"><strong>27</strong><span>Project WicketStuff (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/redirects.html"><strong>28</strong><span>Lost In Redirection With Apache Wicket (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>29</strong><span>Contributing to this guide (Appendix)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="/" target="_blank"><img height="80px" src="http://wicket.apache.org/guide/img/apache-wicket.png"/></a></span>
        
        
        <span id="sponsor"><a href="http://www.apache.org/" target="_blank"><img height="60px" src="http://wicket.apache.org/guide/img/asf_logo.gif"/></a></span>
        
    </div>
    <p>Free Online Guide for Apache Wicket framework</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/security.html">&lt;&lt; <strong>21</strong><span>Security with Wicket</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span> >></a></div>
                


                <div class="project">
                    <h1>22.1 Utility class WicketTester - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Andrea Del Bene, Martin Grigorov, Carsten Hufe, Christian Kroemer, Daniel Bartl, Paul Bor»ô, Tobias Soloschenko</p>

                    <p><strong>Version:</strong> 6.x</p>

                    
                </div>

                

                

<h2 id="testing_1">22.1 Utility class WicketTester</h2>
<p class="paragraph"/>A good way to start getting confident with Wicket unit testing support is looking at the test case class <code>TestHomePage</code> that is automatically generated by Maven when we use Wicket archetype to create a new project:<p class="paragraph"/><img border="0" class="center" src="../img/mvn-wicket-archetype.png"></img><p class="paragraph"/>Here is the content of TestHomePage:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> class TestHomePage&#123;
	<span class="java&#45;keyword">private</span> WicketTester tester;<p class="paragraph"/>	@Before
	<span class="java&#45;keyword">public</span> void setUp()&#123;
		tester = <span class="java&#45;keyword">new</span> WicketTester(<span class="java&#45;keyword">new</span> WicketApplication());
	&#125;
	@Test
	<span class="java&#45;keyword">public</span> void homepageRendersSuccessfully()&#123;
		//start and render the test page
		tester.startPage(HomePage.class);
		//assert rendered page class
		tester.assertRenderedPage(HomePage.class);
	&#125;
&#125;</pre></div><p class="paragraph"/>The central class in a Wicket testing is <code>org.apache.wicket.util.tester.WicketTester</code>. This utility class provides a set of methods to render a component, click links, check if page contains a given component or a feedback message, and so on.<p class="paragraph"/>The basic test case shipped with <code>TestHomePage</code> illustrates how <code>WicketTester</code> is typically instantiated (inside method <code>setUp()</code>). In order to test our components, WicketTester needs to use an instance of <code>WebApplication</code>. Usually, we will use our application class as <code>WebApplication</code>, but we can also decide to build WicketTester invoking its no-argument constructor and letting it automatically build a mock web application (an instance of class <code>org.apache.wicket.mock.MockApplication</code>).<p class="paragraph"/>The code from <code>TestHomePage</code> introduces two basic methods to test our pages. The first is method <code>startPage</code> that renders a new instance of the given page class and sets it as current rendered page for WicketTester. The second method is assertRenderedPage which checks if the current rendered page is an instance of the given class. In this way if TestHomePage succeeds we are sure that page HomePage has been rendered without any problem. The last rendered page can be retrieved with method <code>getLastRenderedPage</code>.<p class="paragraph"/>That's only a taste of what <code>WicketTester</code> can do. In the next paragraphs we will see how it can be used to test every element that composes a Wicket page (links, models, behaviors, etc...).<p class="paragraph"/><h3>Testing links</h3><p class="paragraph"/>A click on a Wicket link can be simulated with method <code>clickLink</code> which takes in input the link component or the page-relative path to it.<p class="paragraph"/>To see an example of usage of clickLink, let's consider again project <code>LifeCycleStagesRevisited</code>. As we know from chapter 5 the home page of the project alternately displays two different labels (‚ÄúFirst label‚Äù and ‚ÄúSecond label‚Äù), swapping between them each time button "reload" is clicked. The code from its test case checks that label has actually changed after button "reload" has been pressed:<p class="paragraph"/><div class="code"><pre>//&#8230;
@Test
<span class="java&#45;keyword">public</span> void switchLabelTest()&#123;
	//start and render the test page
	tester.startPage(HomePage.class);
	//assert rendered page class
	tester.assertRenderedPage(HomePage.class);
	//assert rendered label
	tester.assertLabel(<span class="java&#45;quote">"label"</span>, <span class="java&#45;quote">"First label"</span>);
	//simulate a click on <span class="java&#45;quote">"reload"</span> button
	tester.clickLink(<span class="java&#45;quote">"reload"</span>);
	//assert rendered label
	tester.assertLabel(<span class="java&#45;quote">"label"</span>, <span class="java&#45;quote">"Second label"</span>);	
&#125;
//...</pre></div><p class="paragraph"/>In the code above we have used <code>clickLink</code> to click on the "reload" button and force page to be rendered again. In addition, we have used also method <code>assertLabel</code> that checks if a given label contains the expected text.<p class="paragraph"/>By default <code>clickLink</code> assumes that AJAX is enabled on client side. To switch AJAX off we can use another version of this method that takes in input the path to the link component and a boolean flag that indicates if AJAX must be enabled (true) or not (false).<p class="paragraph"/><div class="code"><pre>//&#8230;
//simulate a click on a button without AJAX support
tester.clickLink(<span class="java&#45;quote">"reload"</span>, <span class="java&#45;keyword">false</span>);
//...</pre></div><p class="paragraph"/><h3>Testing component status</h3><p class="paragraph"/>WicketTester provides also a set of methods to test the states of a component. They are:
<ul class="star">
<li><strong class="bold">assertEnabled(String path)/assertDisabled(String path)</strong>: they test if a component is enabled or not.</li>
<li><strong class="bold">assertVisible(String path)/assertInvisible(String path)</strong>: they test component visibility.</li>
<li><strong class="bold">assertRequired(String path)</strong>: checks if a form component is required.</li>
</ul><p class="paragraph"/>In the test case from project <code>CustomDatepickerAjax</code> we used <code>assertEnabled</code>/<code>assertDisabled</code> to check if button "update" really disables our datepicker:<p class="paragraph"/><div class="code"><pre>//&#8230;
@Test
<span class="java&#45;keyword">public</span> void testDisableDatePickerWithButton()&#123;
	//start and render the test page
	tester.startPage(HomePage.class);
	//assert that datepicker is enabled
	tester.assertEnabled(<span class="java&#45;quote">"form:datepicker"</span>);
	//click on update button to disable datepicker
	tester.clickLink(<span class="java&#45;quote">"update"</span>);
	//assert that datepicker is disabled
	tester.assertDisabled(<span class="java&#45;quote">"form:datepicker"</span>);		
&#125;
//...</pre></div><p class="paragraph"/><h3>Testing components in isolation</h3><p class="paragraph"/>Method <code>startComponent(Component)</code> can be used to test a component in isolation without having to create a container page for this purpose. The target component is rendered and both its methods <code>onInitialize()</code> and <code>onBeforeRender()</code> are executed. In the test case from project <code>CustomFormComponentPanel</code> we used this method to check if our custom form component correctly renders its internal label:<p class="paragraph"/><div class="code"><pre>//&#8230;
@Test
<span class="java&#45;keyword">public</span> void testCustomPanelContainsLabel()&#123;
	TemperatureDegreeField field = <span class="java&#45;keyword">new</span> TemperatureDegreeField(<span class="java&#45;quote">"field"</span>, Model.of(0.00));
	//Use standard JUnit class Assert	
	Assert.assertNull(field.get(<span class="java&#45;quote">"mesuramentUnit"</span>));		
	tester.startComponent(field);		
	Assert.assertNotNull(field.get(<span class="java&#45;quote">"mesuramentUnit"</span>));
&#125;
//...</pre></div><p class="paragraph"/>If test requires a page we can use <code>startComponentInPage(Component)</code> which automatically generates a page for our component.<p class="paragraph"/><h3>Testing the response</h3><p class="paragraph"/><code>WicketTester</code> allows us to access to the last response generated during testing with method <code>getLastResponse</code>. The returned value is an instance of class MockHttpServletResponse that provides helper methods to extract informations from mocked request.<p class="paragraph"/>In the test case from project <code>CustomResourceMounting</code> we extract the text contained in the last response with method <code>getDocument</code> and we check if it is equal to the RSS feed used for the test:<p class="paragraph"/><div class="code"><pre>//&#8230;
@Test
<span class="java&#45;keyword">public</span> void testMountedResourceResponse() <span class="java&#45;keyword">throws</span> IOException, FeedException&#123;tester.startResource(<span class="java&#45;keyword">new</span> RSSProducerResource());
	<span class="java&#45;object">String</span> responseTxt = tester.getLastResponse().getDocument();
	//write the RSS feed used in the test into a ByteArrayOutputStream
	ByteArrayOutputStream outputStream = <span class="java&#45;keyword">new</span> ByteArrayOutputStream();
	Writer writer = <span class="java&#45;keyword">new</span> OutputStreamWriter(outputStream);
	SyndFeedOutput output = <span class="java&#45;keyword">new</span> SyndFeedOutput();<p class="paragraph"/>	output.output(RSSProducerResource.getFeed(), writer);
	//the response and the RSS must be equal 
	Assert.assertEquals(responseTxt, outputStream.toString());
&#125;
//...</pre></div><p class="paragraph"/>To simulate a request to the custom resource we used method <code>startResource</code> which can be used also with resource references.<p class="paragraph"/><h3>Testing URLs</h3><p class="paragraph"/><code>WicketTester</code> can be pointed to an arbitrary URL with method <code>executeUrl(String url)</code>. This can be useful to test mounted pages, resources or request mappers:<p class="paragraph"/><div class="code"><pre>//&#8230;
//the resource was mapped at '/foo/bar'
tester.executeUrl(<span class="java&#45;quote">"./foo/bar"</span>);	
//...</pre></div><p class="paragraph"/><h3>Testing AJAX components</h3><p class="paragraph"/>If our application uses AJAX to refresh components markup, we can test if <code>AjaxRequestTarget</code> contains a given component with <code>WicketTester</code>'s method <code>assertComponentOnAjaxResponse</code>:<p class="paragraph"/><div class="code"><pre>//&#8230;
//test <span class="java&#45;keyword">if</span> AjaxRequestTarget contains a component (using its instance)
tester.assertComponentOnAjaxResponse(amountLabel);	
//&#8230;
//test <span class="java&#45;keyword">if</span> AjaxRequestTarget contains a component (using its path)
tester.assertComponentOnAjaxResponse(<span class="java&#45;quote">"pathToLabel:labelId"</span>);</pre></div><p class="paragraph"/>It's also possible to use method <code>isComponentOnAjaxResponse(Component cmp)</code> to know if a component has been added to <code>AjaxRequestTarget</code>:<p class="paragraph"/><div class="code"><pre>//&#8230;
//test <span class="java&#45;keyword">if</span> AjaxRequestTarget does NOT contain amountLabel 
assertFalse(tester.isComponentOnAjaxResponse(amountLabel));	
//...</pre></div><p class="paragraph"/><h3>Testing AJAX events</h3><p class="paragraph"/>Behavior <code>AjaxEventBehavior</code> and its subclasses can be tested simulating AJAX events with <code>WicketTester</code>'s method <code>executeAjaxEvent(Component cmp, String event)</code>. Here is the sample code from project <code>TestAjaxEventsExample</code>:<p class="paragraph"/><strong class="bold">Home page code:</strong><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> class HomePage <span class="java&#45;keyword">extends</span> WebPage &#123;
 <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">static</span> <span class="java&#45;object">String</span> INIT_VALUE = <span class="java&#45;quote">"Initial value"</span>;
 <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">static</span> <span class="java&#45;object">String</span> OTHER_VALUE = <span class="java&#45;quote">"Other value"</span>;<p class="paragraph"/> <span class="java&#45;keyword">public</span> HomePage(<span class="java&#45;keyword">final</span> PageParameters parameters) &#123;
	<span class="java&#45;keyword">super</span>(parameters);
	Label label;
	add(label = <span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"label"</span>, INIT_VALUE));				
	label.add(<span class="java&#45;keyword">new</span> AjaxEventBehavior(<span class="java&#45;quote">"click"</span>) &#123;<p class="paragraph"/>		@Override
		<span class="java&#45;keyword">protected</span> void onEvent(AjaxRequestTarget target) &#123;
			//change label's data object
			getComponent().setDefaultModelObject(
                                                  OTHER_VALUE);
			target.add(getComponent());
		&#125;
	&#125;).setOutputMarkupId(<span class="java&#45;keyword">true</span>);
	//&#8230;
 &#125;
&#125;</pre></div><p class="paragraph"/><strong class="bold">Test method:</strong><p class="paragraph"/><div class="code"><pre>@Test
<span class="java&#45;keyword">public</span> void testAjaxBehavior()&#123;
	//start and render the test page
	tester.startPage(HomePage.class);
	//test <span class="java&#45;keyword">if</span> label has the initial expected value
	tester.assertLabel(<span class="java&#45;quote">"label"</span>, HomePage.INIT_VALUE);		
	//simulate an AJAX <span class="java&#45;quote">"click"</span> event
	tester.executeAjaxEvent(<span class="java&#45;quote">"label"</span>, <span class="java&#45;quote">"click"</span>);
	//test <span class="java&#45;keyword">if</span> label has changed as expected
	tester.assertLabel(<span class="java&#45;quote">"label"</span>, HomePage.OTHER_VALUE);
&#125;</pre></div><p class="paragraph"/><h3>Testing AJAX behaviors</h3><p class="paragraph"/>To test a generic AJAX behavior we can simulate a request to it using <code>WicketTester</code>'s method <code>executeBehavior(AbstractAjaxBehavior behavior)</code>:<p class="paragraph"/><div class="code"><pre>//&#8230;
AjaxFormComponentUpdatingBehavior ajaxBehavior = 
		<span class="java&#45;keyword">new</span> AjaxFormComponentUpdatingBehavior(<span class="java&#45;quote">"change"</span>)&#123;
	@Override
	<span class="java&#45;keyword">protected</span> void onUpdate(AjaxRequestTarget target) &#123;
		//...				
	&#125;
&#125;;
component.add(ajaxBehavior);
//&#8230;
//execute AJAX behavior, i.e. onUpdate will be invoked 
tester.executeBehavior(ajaxBehavior));	
//...</pre></div><p class="paragraph"/><h3>Using a custom servlet context</h3><p class="paragraph"/>In paragraph 13.9 we have seen how to configure our application to store resource files into a custom folder placed inside webapp root folder (see project <code>CustomFolder4MarkupExample</code>).<p class="paragraph"/>In order to write testing code for applications that use this kind of customization, we must tell <code>WicketTester</code> which folder to use as webapp root. This is necessary as under test environment we don't have any web server, hence it's impossible for <code>WicketTester</code> to retrieve this parameter from servlet context.<p class="paragraph"/>Webapp root folder can be passed to <code>WicketTester</code>'s constructor as further parameter like we did in the test case of project <code>CustomFolder4MarkupExample</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> class TestHomePage&#123;
   <span class="java&#45;keyword">private</span> WicketTester tester;<p class="paragraph"/>   @Before
   <span class="java&#45;keyword">public</span> void setUp()&#123;
      //build the path to webapp root folder   
      File curDirectory = <span class="java&#45;keyword">new</span> File(<span class="java&#45;object">System</span>.getProperty(<span class="java&#45;quote">"user.dir"</span>));
      File webContextDir = <span class="java&#45;keyword">new</span> File(curDirectory, <span class="java&#45;quote">"src/main/webapp"</span>);<p class="paragraph"/>      tester = <span class="java&#45;keyword">new</span> WicketTester(<span class="java&#45;keyword">new</span> WicketApplication(), webContextDir.getAbsolutePath());
   &#125;
   //test methods&#8230;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
After a test method has been executed, we may need to clear any possible side effect occurred to the <code>Application</code> and <code>Session</code> objects. This can be done invoking <code>WicketTester</code>'s method <code>destroy()</code>:<p class="paragraph"/><div class="code"><pre>@After
<span class="java&#45;keyword">public</span> void tearDown()&#123;
	//clear any side effect occurred during test.
	tester.destroy();
&#125;</pre></div>
</blockquote>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/security.html">&lt;&lt; <strong>21</strong><span>Security with Wicket</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
Copyright &copy; 2013-2015 ‚Äî <a href="http://www.apache.org/" target="_blank">The Apache Software Foundation</a> 
                      ‚Äî <b style="color:#E8590A !important;">(Generated on: 2015-04-08)</b>

    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
