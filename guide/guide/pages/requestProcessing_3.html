<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>9.3 The &ldquo;director&rdquo; of request processing - RequestCycle 6.x</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/howToSource.html"><strong>2</strong><span>How to use the example code</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/whyLearn.html"><strong>3</strong><span>Why should I learn Wicket?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/helloWorld.html"><strong>4</strong><span>Wicket says &ldquo;Hello world!&rdquo;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/layout.html"><strong>5</strong><span>Wicket as page layout manager</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/keepControl.html"><strong>6</strong><span>Keeping control over HTML</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/componentLifecycle.html"><strong>7</strong><span>Components lifecycle</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/versioningCaching.html"><strong>8</strong><span>Page versioning and caching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/requestProcessing.html"><strong>9</strong><span>Under the hood of the request processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/modelsforms.html"><strong>11</strong><span>Wicket models and forms</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/forms2.html"><strong>12</strong><span>Wicket forms in detail</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>14</strong><span>Internationalization with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jsintegration.html"><strong>16</strong><span>An example of integration with JavaScript</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/ajax.html"><strong>18</strong><span>Working with AJAX</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jee.html"><strong>19</strong><span>Integration with enterprise containers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/nativewebsockets.html"><strong>20</strong><span>Native WebSockets</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>21</strong><span>Security with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>22</strong><span>Test Driven Development with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/bestpractices.html"><strong>24</strong><span>Wicket Best Practices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/internals.html"><strong>25</strong><span>Wicket Internals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/maven.html"><strong>26</strong><span>Working with Maven (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/wicketstuff.html"><strong>27</strong><span>Project WicketStuff (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/redirects.html"><strong>28</strong><span>Lost In Redirection With Apache Wicket (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>29</strong><span>Contributing to this guide (Appendix)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="/" target="_blank"><img height="80px" src="http://wicket.apache.org/guide/img/apache-wicket.png"/></a></span>
        
        
        <span id="sponsor"><a href="http://www.apache.org/" target="_blank"><img height="60px" src="http://wicket.apache.org/guide/img/asf_logo.gif"/></a></span>
        
    </div>
    <p>Free Online Guide for Apache Wicket framework</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versioningCaching.html">&lt;&lt; <strong>8</strong><span>Page versioning and caching</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span> >></a></div>
                


                <div class="project">
                    <h1>9.3 The &ldquo;director&rdquo; of request processing - RequestCycle - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Andrea Del Bene, Martin Grigorov, Carsten Hufe, Christian Kroemer, Daniel Bartl, Paul Borș, Tobias Soloschenko</p>

                    <p><strong>Version:</strong> 6.x</p>

                    
                </div>

                

                

<h2 id="requestProcessing_3">9.3 The “director” of request processing - RequestCycle</h2>
<p class="paragraph"/>Class <code>org.apache.wicket.request.cycle.RequestCycle</code> is the entity in charge of serving a web request. Our application class creates a new <code>RequestCycle</code> on every request with its method <code>createRequestCycle(request, response)</code>.<p class="paragraph"/>Method <code>createRequestCycle</code> is declared as final, so we can't override it to return a custom subclass of <code>RequestCycle</code>. Instead, we must build a request cycle provider implementing interface <code>org.apache.wicket.IRequestCycleProvider</code>, and then we must tell our application class to use it via the <code>setRequestCycleProvider</code> method.<p class="paragraph"/>The current running request cycle can be retrieved at any time by calling its static method <code>RequestCycle.get()</code>. Strictly speaking this method returns the request cycle associated with the current (or local) thread, which is the thread that is serving the current request. A similar <code>get()</code> method is also implemented in classes <code>org.apache.wicket.Application</code> (as we have seen in paragraph 2.2.2) and <code>org.apache.wicket.Session</code> in order to get the application and the session in use by the current thread.<p class="paragraph"/><blockquote class="note">
The implementation of the get method takes advantage of the standard class <code>java.lang.ThreadLocal</code>. See its JavaDoc for an introduction to local-thread variables.
</blockquote><p class="paragraph"/>Class <code>org.apache.wicket.Component</code> provides the <code>getRequestCycle()</code> method which is a convenience method that internally invokes <code>RequestCycle.get()</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> <span class="java&#45;keyword">final</span> RequestCycle getRequestCycle() &#123;
	<span class="java&#45;keyword">return</span> RequestCycle.get();
&#125;</pre></div><p class="paragraph"/><h3>RequestCycle and request processing</h3><p class="paragraph"/><blockquote class="note">
This paragraph will provide just the basic informations about what happens behind the scenes of request processing. When you work with Wicket it's unlikely to have a need for customizing this process, so we won't cover this topic in detail.
</blockquote><p class="paragraph"/>In order to process a request, <code>RequestCycle</code> delegates the task to another entity which implements interface <code>org.apache.wicket.request.IRequestHandler</code>. There are different implementations of this interface, each suited for a particular type of requested resource (a page to render, an AJAX request, an URL to an external page, etc.).<p class="paragraph"/>To resolve the right handler for a given HTTP request, the <code>RequestCycle</code> uses a set of objects implementing the <code>org.apache.wicket.request.IRequestMapper</code> interface. The mapping interface defines the <code>getCompatibilityScore(Request request)</code> method which returns a score indicating how compatible the request mapper is for the current request. <code>RequestCycle</code> will choose the mapper with the highest score and it will call its <code>mapRequest(Request request)</code> method to get the proper handler for the given request. Once <code>RequestCycle</code> has resolved a request handler, it invokes its method <code>respond(IRequestCycle requestCycle)</code> to start request processing.<p class="paragraph"/>The following sequence diagram recaps how a request handler is resolved by the <code>RequestCycle</code>:<p class="paragraph"/><img border="0" class="center" src="../img/request-cycle-handler.png"></img><p class="paragraph"/>Developers can create additional implementations of IRequestMapper and add them to their application via the mount(IRequestMapper mapper) method of the WebApplication class. In paragraph 10.6 we will see how Wicket uses this method to add built-in mappers for mounted pages.<p class="paragraph"/><h3>Generating URL with the urlFor and mapUrlFor methods</h3><p class="paragraph"/>The RequestCycle is also responsible for generating the URL value (as CharSequence) for the following entities:
<ul class="star">
<li>a page class, via the <code>urlFor(Class&#60;C&#62; pageClass, PageParameters parameters)</code> method</li>
<li>an IRequestHandler via the <code>urlFor(IRequestHandler handler)</code> method</li>
<li>a ResourceReference via the <code>urlFor(ResourceReference reference, PageParameters params)</code> method (resource entities will be introduced in chapter 13).</li>
</ul><p class="paragraph"/>The overloaded <code>urlFor</code> method from above also has a corresponding version that returns an instance of <code>org.apache.wicket.request.Url</code> instead of a <code>CharSequence</code>. This version has the prefix 'map' in its name (i.e. it has <code>mapUrlFor</code> as full name).<p class="paragraph"/><h3>Method setResponsePage</h3><p class="paragraph"/>The <code>RequestCycle</code> class contains the implementation of the <code>setResponsePage</code> method we use to redirect a user to a specific page (see paragraph 2.4). The namesake method of class <code>org.apache.wicket.Component</code> is just a convenience method that internally invokes the actual implementation on current request cycle:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> <span class="java&#45;keyword">final</span> void setResponsePage(<span class="java&#45;keyword">final</span> Page page) &#123;
	getRequestCycle().setResponsePage(page);
&#125;</pre></div><p class="paragraph"/><h3>RequestCycle's hook methods and listeners</h3><p class="paragraph"/>The RequestCycle comes with some hook methods which can be overridden to perform custom actions when request handling reaches a specific stage. These methods are:
<ul class="star">
<li><strong class="bold">onBeginRequest():</strong> called when the RequestCycle is about to start handling the request.</li>
<li><strong class="bold">onEndRequest():</strong> called when the RequestCycle has finished to handle the request</li>
<li><strong class="bold">onDetach():</strong> called after the request handling has completed and the RequestCycle is about to be detached from its thread. The default implementation of this method invokes detach() on the current session (the Session class will be shortly discussed in paragraph 9.4).</li>
</ul><p class="paragraph"/>Methods onBeforeRequest and onEndRequest can be used if we need to execute custom actions before and after business code is executed, such as opening a Hibernate/JPA session and closing it when code has terminated.<p class="paragraph"/>A more flexible way to interact with the request processing is to use the listener interface <code>org.apache.wicket.request.cycle.IRequestCycleListener</code>. In addition to the three methods already seen for RequestCycle, this interface offers further hooks into request processing:
<ul class="star">
<li><strong class="bold">onBeginRequest(RequestCycle cycle):</strong> (see the description above)</li>
<li><strong class="bold">onEndRequest(RequestCycle cycle):</strong> (see the description above)</li>
<li><strong class="bold">onDetach(RequestCycle cycle):</strong> (see the description above)</li>
<li><strong class="bold">onRequestHandlerResolved(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been resolved.</li>
<li><strong class="bold">onRequestHandlerScheduled(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been scheduled for execution.</li>
<li><strong class="bold">onRequestHandlerExecuted(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been executed.</li>
<li><strong class="bold">onException(RequestCycle cycle, Exception ex):</strong> called when an exception has been thrown during request processing.</li>
<li><strong class="bold">onExceptionRequestHandlerResolved(RequestCycle rc, IRequestHandler rh, Exception ex):</strong> called when an IRequestHandler has been resolved and will be used to handle an exception.</li>
<li><strong class="bold">onUrlMapped(RequestCycle cycle, IRequestHandler handler, Url url):</strong> called when an URL has been generated for an IRequestHandler object.</li>
</ul><p class="paragraph"/>To use the request cycle listeners we must add them to our application which in turn will pass them to the new <code>RequestCycle</code>'s instances created with <code>createRequestCycle</code> method:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">public</span> void init() &#123;<p class="paragraph"/>	<span class="java&#45;keyword">super</span>.init();<p class="paragraph"/>	IRequestCycleListener myListener;
	//listener initialization&#8230;
	getRequestCycleListeners().add(myListener)		
&#125;</pre></div><p class="paragraph"/>The <code>getRequestCycleListeners</code> method returns an instance of class <code>org.apache.wicket.request.cycle.RequestCycleListenerCollection</code>. This class is a sort of typed collection for <code>IRequestCycleListener</code> and it also implements the <a href="http://en.wikipedia.org/wiki/Composite_pattern" target="blank">Composite pattern</a> .<p class="paragraph"/>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versioningCaching.html">&lt;&lt; <strong>8</strong><span>Page versioning and caching</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
Copyright &copy; 2013-2015 — <a href="http://www.apache.org/" target="_blank">The Apache Software Foundation</a> 
                      — <b style="color:#E8590A !important;">(Generated on: 2015-04-08)</b>

    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
