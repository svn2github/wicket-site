<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>12.9 Creating complex form components with FormComponentPanel 6.x</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/howToSource.html"><strong>2</strong><span>How to use the example code</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/whyLearn.html"><strong>3</strong><span>Why should I learn Wicket?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/helloWorld.html"><strong>4</strong><span>Wicket says &ldquo;Hello world!&rdquo;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/layout.html"><strong>5</strong><span>Wicket as page layout manager</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/keepControl.html"><strong>6</strong><span>Keeping control over HTML</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/componentLifecycle.html"><strong>7</strong><span>Components lifecycle</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/versioningCaching.html"><strong>8</strong><span>Page versioning and caching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/requestProcessing.html"><strong>9</strong><span>Under the hood of the request processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/modelsforms.html"><strong>11</strong><span>Wicket models and forms</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/forms2.html"><strong>12</strong><span>Wicket forms in detail</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>14</strong><span>Internationalization with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jsintegration.html"><strong>16</strong><span>An example of integration with JavaScript</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/ajax.html"><strong>18</strong><span>Working with AJAX</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/jee.html"><strong>19</strong><span>Integration with enterprise containers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/nativewebsockets.html"><strong>20</strong><span>Native WebSockets</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>21</strong><span>Security with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>22</strong><span>Test Driven Development with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/bestpractices.html"><strong>24</strong><span>Wicket Best Practices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/internals.html"><strong>25</strong><span>Wicket Internals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/maven.html"><strong>26</strong><span>Working with Maven (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/wicketstuff.html"><strong>27</strong><span>Project WicketStuff (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/redirects.html"><strong>28</strong><span>Lost In Redirection With Apache Wicket (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>29</strong><span>Contributing to this guide (Appendix)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="/" target="_blank"><img height="80px" src="http://wicket.apache.org/guide/img/apache-wicket.png"/></a></span>
        
        
        <span id="sponsor"><a href="http://www.apache.org/" target="_blank"><img height="60px" src="http://wicket.apache.org/guide/img/asf_logo.gif"/></a></span>
        
    </div>
    <p>Free Online Guide for Apache Wicket framework</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/modelsforms.html">&lt;&lt; <strong>11</strong><span>Wicket models and forms</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span> >></a></div>
                


                <div class="project">
                    <h1>12.9 Creating complex form components with FormComponentPanel - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Andrea Del Bene, Martin Grigorov, Carsten Hufe, Christian Kroemer, Daniel Bartl, Paul Bor»ô, Tobias Soloschenko</p>

                    <p><strong>Version:</strong> 6.x</p>

                    
                </div>

                

                

<h2 id="forms2_9">12.9 Creating complex form components with FormComponentPanel</h2>
<p class="paragraph"/>In chapter 3.2.2 we have seen how to use class Panel to create custom components with their own markup and with an arbitrary number of children components.<p class="paragraph"/>While it's perfectly legal to use Panel also to group form components, the resulting component won't be itself a form component and it won't participate in the form's submission workflow.<p class="paragraph"/>This could be a strong limitation if the custom component needs to coordinate its children during sub-tasks like input conversion or model updating. That's why in Wicket we have the <code>org.apache.wicket.markup.html.form.FormComponentPanel</code> component which combines the features of a Panel (it has its own markup file) and a FormComponent (it is a subclass of FormComponent).<p class="paragraph"/>A typical scenario in which we may need to implement a custom FormComponentPanel is when our web application and its users work with different units of measurement for the same data.<p class="paragraph"/>To illustrate this possible scenario, let's consider a form where a user can insert a  temperature that will be recorded after being converted to Kelvin degrees (see the example project CustomForm ComponentPanel).<p class="paragraph"/>The Kelvin scale is wildly adopted among the scientific community and it is one of the seven base units of the <a href="http://en.wikipedia.org/wiki/International_System_of_Units" target="blank">International System of Units</a> , so it makes perfect sense to store temperatures expressed with this unit of measurement.<p class="paragraph"/>However, in our everyday life we still use other temperature scales like Celsius or Fahrenheit, so it would be nice to have a component which internally works with Kelvin degrees and automatically applies conversion between Kelvin temperature scale and the one adopted by the user.<p class="paragraph"/>In order to implement such a component, we can make a subclass of FormComponentPanel and leverage the convertInput and onBeforeRender methods: in the implementation of the convertInput method we will convert input value to Kelvin degrees while in the implementation of onBeforeRender method we will take care of converting the Kelvin value to the temperature scale adopted by the user.<p class="paragraph"/>Our custom component will contain two children components: a text field to let user insert and edit a temperature value and a label to display the letter corresponding to user's temperature scale (F for Fahrenheit and C for Celsius). The resulting markup file is the following:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;
&#60;head&#62;
&#60;/head&#62;
&#60;body&#62;
	&#60;wicket:panel&#62;
		Registered temperature: &#60;input size=<span class="java&#45;quote">"3"</span> maxlength=<span class="java&#45;quote">"3"</span>         
                             wicket:id=<span class="java&#45;quote">"registeredTemperature"</span>/&#62; 
		&#60;label wicket:id=<span class="java&#45;quote">"mesuramentUnit"</span>&#62;&#60;/label&#62; 
	&#60;/wicket:panel&#62;
&#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/>As shown in the markup above FormComponentPanel uses the same &#60;wicket:panel&#62; tag used by Panel to define its markup. Now let's see the Java code of the new form component starting with the onInitialize() method:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> class TemperatureDegreeField <span class="java&#45;keyword">extends</span> FormComponentPanel&#60;<span class="java&#45;object">Double</span>&#62; &#123;<p class="paragraph"/>	<span class="java&#45;keyword">private</span> TextField&#60;<span class="java&#45;object">Double</span>&#62; userDegree;<p class="paragraph"/>	<span class="java&#45;keyword">public</span> TemperatureDegreeField(<span class="java&#45;object">String</span> id) &#123;
		<span class="java&#45;keyword">super</span>(id);		
	&#125;<p class="paragraph"/>	<span class="java&#45;keyword">public</span> TemperatureDegreeField(<span class="java&#45;object">String</span> id, IModel&#60;<span class="java&#45;object">Double</span>&#62; model) &#123;
		<span class="java&#45;keyword">super</span>(id, model);		
	&#125;<p class="paragraph"/>	@Override
	<span class="java&#45;keyword">protected</span> void onInitialize() &#123;
		<span class="java&#45;keyword">super</span>.onInitialize();<p class="paragraph"/>	     AbstractReadOnlyModel&#60;<span class="java&#45;object">String</span>&#62; labelModel=<span class="java&#45;keyword">new</span> AbstractReadOnlyModel&#60;<span class="java&#45;object">String</span>&#62;()&#123;
			@Override
			<span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getObject() &#123;
				<span class="java&#45;keyword">if</span>(getLocale().equals(Locale.US))
					<span class="java&#45;keyword">return</span> <span class="java&#45;quote">"¬∞F"</span>;
				<span class="java&#45;keyword">return</span> <span class="java&#45;quote">"¬∞C"</span>;
			&#125;
		&#125;;<p class="paragraph"/>		add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"mesuramentUnit"</span>, labelModel));
		add(userDegree=<span class="java&#45;keyword">new</span> TextField&#60;<span class="java&#45;object">Double</span>&#62;(<span class="java&#45;quote">"registeredTemperature"</span>, <span class="java&#45;keyword">new</span> 
                           Model&#60;<span class="java&#45;object">Double</span>&#62;()));
		userDegree.setType(<span class="java&#45;object">Double</span>.class);
	&#125;</pre></div><p class="paragraph"/>Inside the onInitialize method we have created a read-only model for the label that displays the letter corresponding to the user's temperature scale. To determinate which temperature scale is in use, we retrieve the Locale from the session by calling Component's getLocale() method (we will talk more about this method in chapter 12). Then, if locale is the one corresponding to the United States, the chosen scale will be Fahrenheit, otherwise it will be considered as Celsius.<p class="paragraph"/>In the final part of onInitialize() we add the two components to our custom form component. You may have noticed that we have explicitly set the type of model object for the text field to double. This is necessary as the starting model object is a null reference and this prevents the component from automatically determining the type of its model object.<p class="paragraph"/>Now we can look at the rest of the code containing the convertInput and onBeforeRender methods:<p class="paragraph"/><div class="code"><pre>// continued example
	@Override
	<span class="java&#45;keyword">protected</span> void convertInput() &#123;
		<span class="java&#45;object">Double</span> userDegreeVal = userDegree.getConvertedInput();
		<span class="java&#45;object">Double</span> kelvinDegree;<p class="paragraph"/>		<span class="java&#45;keyword">if</span>(getLocale().equals(Locale.US))&#123;
			kelvinDegree = userDegreeVal +  459.67;
			BigDecimal bdKelvin = <span class="java&#45;keyword">new</span> BigDecimal(kelvinDegree);
			BigDecimal fraction = <span class="java&#45;keyword">new</span> BigDecimal(5).divide(<span class="java&#45;keyword">new</span> BigDecimal(9));<p class="paragraph"/>			kelvinDegree = bdKelvin.multiply(fraction).doubleValue();
		&#125;<span class="java&#45;keyword">else</span>&#123;
			kelvinDegree = userDegreeVal + 273.15;
		&#125;<p class="paragraph"/>		setConvertedInput(kelvinDegree);
	&#125;<p class="paragraph"/>	@Override
	<span class="java&#45;keyword">protected</span> void onBeforeRender() &#123;
		<span class="java&#45;keyword">super</span>.onBeforeRender();<p class="paragraph"/>		<span class="java&#45;object">Double</span> kelvinDegree = (<span class="java&#45;object">Double</span>) getDefaultModelObject();		
		<span class="java&#45;object">Double</span> userDegreeVal = <span class="java&#45;keyword">null</span>;<p class="paragraph"/>		<span class="java&#45;keyword">if</span>(kelvinDegree == <span class="java&#45;keyword">null</span>) <span class="java&#45;keyword">return</span>;<p class="paragraph"/>		<span class="java&#45;keyword">if</span>(getLocale().equals(Locale.US))&#123;
			BigDecimal bdKelvin = <span class="java&#45;keyword">new</span> BigDecimal(kelvinDegree);
			BigDecimal fraction = <span class="java&#45;keyword">new</span> BigDecimal(9).divide(<span class="java&#45;keyword">new</span> BigDecimal(5));<p class="paragraph"/>			kelvinDegree = bdKelvin.multiply(fraction).doubleValue();
			userDegreeVal = kelvinDegree &#45; 459.67;
		&#125;<span class="java&#45;keyword">else</span>&#123;
			userDegreeVal = kelvinDegree &#45; 273.15;
		&#125;<p class="paragraph"/>		userDegree.setModelObject(userDegreeVal);
	&#125;
&#125;</pre></div><p class="paragraph"/>Since our component does not directly receive the user input, convertInput() must read this value from the inner text field using FormComponent's getConvertedInput() method which returns the input value already converted to the type specified for the component (Double in our case). Once we have the user input we convert it to kelvin degrees and we use the resulting value to set the converted input for our custom component (using method setConvertedInput(T convertedInput)).<p class="paragraph"/>Method onBeforeRender() is responsible for synchronizing the model of the inner textfield with the model of our custom component. To do this we retrieve the model object of the custom component with the getDefaultModelObject() method, then we convert it to the temperature scale adopted by the user and finally we use this value to set the model object of the text field.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/modelsforms.html">&lt;&lt; <strong>11</strong><span>Wicket models and forms</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
Copyright &copy; 2013-2015 ‚Äî <a href="http://www.apache.org/" target="_blank">The Apache Software Foundation</a> 
                      ‚Äî <b style="color:#E8590A !important;">(Generated on: 2015-04-10)</b>

    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
