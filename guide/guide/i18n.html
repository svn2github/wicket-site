<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>14 Internationalization with Wicket 6.x</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/howToSource.html"><strong>2</strong><span>How to use the example code</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/whyLearn.html"><strong>3</strong><span>Why should I learn Wicket?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helloWorld.html"><strong>4</strong><span>Wicket says &ldquo;Hello world!&rdquo;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/layout.html"><strong>5</strong><span>Wicket as page layout manager</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/keepControl.html"><strong>6</strong><span>Keeping control over HTML</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/componentLifecycle.html"><strong>7</strong><span>Components lifecycle</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/versioningCaching.html"><strong>8</strong><span>Page versioning and caching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestProcessing.html"><strong>9</strong><span>Under the hood of the request processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urls.html"><strong>10</strong><span>Wicket Links and URL generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/modelsforms.html"><strong>11</strong><span>Wicket models and forms</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/forms2.html"><strong>12</strong><span>Wicket forms in detail</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/repeaters.html"><strong>13</strong><span>Displaying multiple items with repeaters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>14</strong><span>Internationalization with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/jsintegration.html"><strong>16</strong><span>An example of integration with JavaScript</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/advanced.html"><strong>17</strong><span>Wicket advanced topics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ajax.html"><strong>18</strong><span>Working with AJAX</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/jee.html"><strong>19</strong><span>Integration with enterprise containers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/nativewebsockets.html"><strong>20</strong><span>Native WebSockets</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>21</strong><span>Security with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/testing.html"><strong>22</strong><span>Test Driven Development with Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/testingspring.html"><strong>23</strong><span>Test Driven Development with Wicket and Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/bestpractices.html"><strong>24</strong><span>Wicket Best Practices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/internals.html"><strong>25</strong><span>Wicket Internals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/maven.html"><strong>26</strong><span>Working with Maven (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/wicketstuff.html"><strong>27</strong><span>Project WicketStuff (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/redirects.html"><strong>28</strong><span>Lost In Redirection With Apache Wicket (Appendix)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/contributing.html"><strong>29</strong><span>Contributing to this guide (Appendix)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="/" target="_blank"><img height="80px" src="http://wicket.apache.org/guide/img/apache-wicket.png"/></a></span>
        
        
        <span id="sponsor"><a href="http://www.apache.org/" target="_blank"><img height="60px" src="http://wicket.apache.org/guide/img/asf_logo.gif"/></a></span>
        
    </div>
    <p>Free Online Guide for Apache Wicket framework</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/repeaters.html">&lt;&lt; <strong>13</strong><span>Displaying multiple items with repeaters</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span> >></a></div>
                


                <div class="project">
                    <h1>14 Internationalization with Wicket - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Andrea Del Bene, Martin Grigorov, Carsten Hufe, Christian Kroemer, Daniel Bartl, Paul Bor»ô, Tobias Soloschenko</p>

                    <p><strong>Version:</strong> 6.x</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_1"><strong>14.1</strong><span>Localization</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_2"><strong>14.2</strong><span>Localization in Wicket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_3"><strong>14.3</strong><span>Bundles lookup algorithm</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_4"><strong>14.4</strong><span>Localization of component's choices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_5"><strong>14.5</strong><span>Internationalization and Models</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#i18n_6"><strong>14.6</strong><span>Summary</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="i18n">14 Internationalization with Wicket</h1>
In chapter 10 we have seen how the topic of localization is involved in the generation of feedback messages and we had a first contact with resource bundles. In this chapter we will continue to explore the localization support provided by Wicket and we will learn how to build pages and components ready to be localized in different languages.


<h2 id="i18n_1">14.1 Localization</h2>
<p class="paragraph"/>As we have seen in chapter 10, the infrastructure of feedback messages is built on top of Java internationalization (i18n) support, so it should not be surprising that the same infrastructure is used also for localization purpose. However, while so far we have used only the &#60;ApplicationClassName&#62;.properties file to store our custom messages, in this chapter we will see that also pages, components, validators and even Java packages can have their own resource bundles. This allows us to split bundles into multiple files keeping them close to where they are used. But before diving into the details of internationalization with Wicket, it's worthwhile to quickly review how i18n works under Java, see what classes are involved and how they are integrated into Wicket.<p class="paragraph"/><blockquote class="note">
Providing a full description of Java support for i18n is clearly out of the scope of this document. If you need more informations about this topic you can find them in the JavaDocs and in the official <a href="http://docs.oracle.com/javase/tutorial/i18n/index.html" target="blank">i18n tutorial</a> .
</blockquote><p class="paragraph"/><h3>Class Locale and ResourceBundle</h3><p class="paragraph"/>Class java.util.Locale represents a specific country or language of the world and is used in Java to retrieve other locale-dependent informations like numeric and date formats, the currency in use in a country and so on. Such kind of informations are accessed through special entities called resource bundles which are implemented by class <code>java.util.ResourceBundle</code>. Every resource bundle is identified by a full name which is built using four parameters: a base name (which is required), a language code, a country code and a variant (which are all optional). These three optional parameters are provided by an instance of Locale with its three corresponding getter methods: getLanguage(), getCountry() and getVariant(). Parameter language code is a lowercase ISO 639 2-letter code (like zh for Chinese, de for German and so on) while country code is an uppercase ISO 3166 2-letter code (like CN for China, DE for Germany and so on). The final full name will have the following structure (NOTE: tokens inside squared brackets are optional):<p class="paragraph"/><div class="code"><pre>&#60;base name&#62;&#91; <em class="italic">&#60;language code&#62;&#91;</em> &#60;COUNTRY_CODE&#62;&#91;_&#60;variant code&#62;&#93;&#93;&#93;</pre></div><p class="paragraph"/>For example a bundle with MyBundle as base name and localized for Mandarin Chinese (language code zh, country code CH, variant cmn) will have MyBundle_zh_CH_cmn as full name. A base name can be a fully qualified class name, meaning that it can include a package name before the actual base name. The specified package will be the container of the given bundle. For example if we use org.foo.MyBundle as base name, the bundle named MyBundle will be searched inside package org.foo. The actual base name (MyBundle in our example) will be used to build the full name of the bundle following the same rules seen above.
<code>ResourceBundle</code> is an abstract factory class, hence it exposes a number of factory methods named  getBundle to load a concrete bundle. Without going into too much details we can say that a bundle corresponds to a file in the classpath. To find a file for a given bundle, getBundle needs first to generate an ordered list of candidate bundle names. These names are the set of all possible full names for a given bundle. For example if we have org.foo.MyBundle as base name and the current locale is the one seen before for Mandarin Chinese, the candidate names will be:
<ol>
<li>org.foo.MyBundle_zh_CH_cmn</li>
<li>org.foo.MyBundle_zh_CH</li>
<li>org.foo.MyBundle_zh</li>
<li>org.foo.MyBundle</li>
</ol><p class="paragraph"/>The list of these candidate names is generated starting from the most specific one and subtracting an optional parameter at each step. The last name of the list corresponds to the default resource bundle which is the most general name and is equal to the base name. Once that getBundle has generated the list of candidate names, it will iterate over them to find the first one for which is possible to load a class or a properties file. The class must be a subclass of <code>ResourceBundle</code> having as class name the full name used in the current iteration. If such a class is not found, getBundle will try to locate a properties file having a file name equals to the current full name (Java will automatically append extension .properties to the full name). For example given the resource bundle of the previous example, Java will search first for class org.foo.MyBundle_zh_CH_cmn and then for file MyBundle_zh_CH_cmn.properties inside package org.foo. If no file is found for any of the candidate names, a MissingResourceException will be thrown. Bundles contains local-dependent string resources identified by a key that is unique in the given bundle. So once we have obtained a valid bundle we can access these objects with method getString (String key).<p class="paragraph"/>As we have seen before working with feedback messages, in Wicket most of the times we will work with properties files rather than with bundle classes. In chapter 10 we used a properties file having as base name the class name of the application class and without any information about the locale. This file is the default resource bundle for a Wicket application. In paragraph 12.4 we will explore the algorithm used in Wicket to locate the available bundles for a given component. Once we have learnt how to leverage this algorithm, we will be able to split our bundles into more files organized in a logical hierarchy.


<h2 id="i18n_2">14.2 Localization in Wicket</h2>
<p class="paragraph"/>A component can get the current locale in use calling its method getLocale(). By default this method will be recursively called on component's parent containers until one of them returns a valid locale. If no one of them returns a locale, this method will get the one associated with the current user session. This locale is automatically generated by Wicket in accordance with the language settings of the browser.<p class="paragraph"/>Developers can change the locale of the current session with Session's method setLocale (Locale locale):<p class="paragraph"/><div class="code"><pre>Session.get().setLocale(locale)</pre></div><p class="paragraph"/><h3>Style and variation parameters for bundles</h3><p class="paragraph"/>In addition to locale's informations, Wicket supports two further parameters to identify a resource bundle: style and variation. Parameter style is a string value and is defined at session-level. To set/get the style for the current session we can use the corresponding setter and getter of class Session:<p class="paragraph"/><div class="code"><pre>Session.get().setStyle(<span class="java&#45;quote">"myStyle"</span>);
Session.get().getStyle();</pre></div><p class="paragraph"/>If set, style's value contributes to the final full name of the bundle and it is placed between the base name and the locale's informations:<p class="paragraph"/><div class="code"><pre>&#60;base name&#62;&#91; <em class="italic">style&#93;&#91;</em> &#60;language code&#62;&#91; <em class="italic">&#60;COUNTRY_CODE&#62;&#91;</em> &#60;variant code&#62;&#93;&#93;&#93;</pre></div><p class="paragraph"/>Wicket gives the priority to candidate names containing the style information (if available). The other parameter we can use for localization is variation. Just like style also variation is a string value, but it is defined at component-level. The value of variation is returned by Component's method getVariation(). By default this method returns the variation of the parent component or a null value if a component hasn't a parent (i.e. it's a page). If we want to customize this parameter we must overwrite method  getVariation and make it return the desired value.<p class="paragraph"/>Variation's value contributes to the final full name of the bundle and is placed before style parameter:<p class="paragraph"/><div class="code"><pre>&#60;base name&#62;&#91; <em class="italic">variation&#93;&#91;_style&#93;&#91;</em> &#60;language code&#62;&#91; <em class="italic">&#60;COUNTRY_CODE&#62;&#91;</em> &#60;variant code&#62;&#93;&#93;&#93;</pre></div><p class="paragraph"/>
<h3>Using UTF-8 for resource bundles</h3><p class="paragraph"/>Java uses the standard character set <a href="http://en.wikipedia.org/wiki/ISO/IEC_8859-1" target="blank">ISO 8859-11</a> to encode text files like properties files. Unfortunately ISO 8859-1 does not support most of the extra-European languages like Chinese or Japanese. The only way to use properties files with such languages is to use escaped <a href="http://en.wikipedia.org/wiki/List_of_Unicode_characters" target="blank">Unicode</a> characters, but this leads to not human-readable files. For example if we wanted to write the word 'website' in simplified Chinese (the ideograms are ÁΩëÁ´ô) we should write the Unicode characters <code>&#117;7F51&#117;7AD9</code>.
For this reason ISO 8859-11 is being replaced with another Unicode-compliant character encoding called UTF-8. Text files created with this encoding can contain Unicode symbols in plain format.
Wicket provides a useful convention to use properties file encoded with UTF-8. We just have to add prefix <code>.utf8.</code> to file extension (i.e. <code>.utf8.properties</code>).<p class="paragraph"/><blockquote class="note">
If you want to use UTF-8 with your text files, make sure that your editor/IDE is actually using this character encoding. Some OS like Windows use a different encoding by default.
</blockquote><p class="paragraph"/><h3>Using XML files as resource bundles</h3><p class="paragraph"/>Starting from version 1.5, Java introduced the support for XML files as resource bundles. XML files are generally encoded with character sets UTF-8 or UTF-16 which support every symbol of the Unicode standard. In order to be a valid resource bundle the XML file must conform to the DTD available at <a href="http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd" target="blank">http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd</a> .<p class="paragraph"/>Here is an example of XML resource bundle taken from project LocalizedGreetings (file WicketApplication_zh.properties.xml) containing the translation in simplified Chinese of the greeting message ‚ÄúWelcome to the website!‚Äù:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version=<span class="xml&#45;quote">"1.0"</span> encoding=<span class="xml&#45;quote">"UTF&#45;8"</span>?&#62;</span>
&#60;!DOCTYPE properties SYSTEM <span class="xml&#45;quote">"http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd"</span>&#62;
<span class="xml&#45;tag">&#60;properties&#62;</span>
	<span class="xml&#45;tag">&#60;entry key=<span class="xml&#45;quote">"greetingMessage"</span>&#62;</span>Ê¨¢ËøéÂÖâ‰∏¥Êú¨ÁΩëÁ´ôÔºÅ<span class="xml&#45;tag">&#60;/entry&#62;</span>
<span class="xml&#45;tag">&#60;/properties&#62;</span></pre></div><p class="paragraph"/>To use XML bundles in Wicket we don't need to put in place any additional configuration. The only rule we have to respect with these files is to use properties.xml as extension while their base name follows the same rules seen so far for bundle names.<p class="paragraph"/><h3>Reading bundles from code</h3><p class="paragraph"/>Class Component makes reading bundles very easy with method getString(String key). This method searches for a resource with the given key looking into the resource bundles visited by the lookup algorithm illustrated in paragraph 12.4. For example if we have a greeting message with key greetingMessage in our application's resource  bundle, we can read it from our component code with this instruction:<p class="paragraph"/><div class="code"><pre>getString(<span class="java&#45;quote">"greetingMessage"</span>);</pre></div><p class="paragraph"/><h3>Localization of bundles in Wicket</h3><p class="paragraph"/>In chapter 10 we have used as resource bundle the properties file placed next to our application class. This file is the default resource bundle for the entire application and it is used by the lookup algorithm if it doesn't find any better match for a given component and locale. If we want to provide localized versions of this file we must simply follow the rules of Java i18n and put our translated resources into another properties file with a name corresponding to the desired locale. For example project LocalizedGreetings comes with the default application's properties file ( WicketApplication.properties) containing a greeting message:<p class="paragraph"/><div class="code"><pre>greetingMessage=Welcome to the site!</pre></div><p class="paragraph"/>Along with this file we can also find a bundle for German (WicketApplication_de.properties) and another one in XML format for simplified Chinese (WicketApplication_zh.properties.xml). The example project consists of a single page (HomePage.java) displaying the greeting message. The current locale can be changed with a drop-down list and the possible options are English (the default one), German and simplified Chinese:<p class="paragraph"/><img border="0" class="center" src="../img/locale-german.png"></img><p class="paragraph"/>The label displaying the greeting message has a custom read-only model which returns the message with method getString. The initialization code for this label is this:<p class="paragraph"/><div class="code"><pre>AbstractReadOnlyModel&#60;<span class="java&#45;object">String</span>&#62; model = <span class="java&#45;keyword">new</span> AbstractReadOnlyModel&#60;<span class="java&#45;object">String</span>&#62;() &#123;			
			@Override
			<span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getObject() &#123;
				<span class="java&#45;keyword">return</span> getString(<span class="java&#45;quote">"greetingMessage"</span>);			
			&#125;
&#125;;<p class="paragraph"/>add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"greetingMessage"</span>, model));</pre></div><p class="paragraph"/>Class <code>org.apache.wicket.model.AbstractReadOnlyModel</code> is a convenience class for implementing read-only models. In this project we have implemented a custom read-only model for illustrative purposes only because Wicket already provides built-in models for the same task. We will see them in paragraph 12.6.<p class="paragraph"/>The rest of the code of the home page builds the stateless form and the drop-down menu used to change the locale.<p class="paragraph"/><div class="code"><pre>List&#60;Locale&#62; locales = Arrays.asList(Locale.ENGLISH, Locale.CHINESE, Locale.GERMAN);
<span class="java&#45;keyword">final</span> DropDownChoice&#60;Locale&#62; changeLocale = 
             <span class="java&#45;keyword">new</span> DropDownChoice&#60;Locale&#62;(<span class="java&#45;quote">"changeLocale"</span>, <span class="java&#45;keyword">new</span> Model&#60;Locale&#62;(), locales);<p class="paragraph"/>StatelessForm form = <span class="java&#45;keyword">new</span> StatelessForm(<span class="java&#45;quote">"form"</span>)&#123;
	@Override
	<span class="java&#45;keyword">protected</span> void onSubmit() &#123;
		Session.get().setLocale(changeLocale.getModelObject());
	&#125;
&#125;;<p class="paragraph"/>setStatelessHint(<span class="java&#45;keyword">true</span>);
add(form.add(changeLocale))</pre></div><p class="paragraph"/>
<h3>Localization of markup files</h3><p class="paragraph"/>Although resource bundles exist to extract local-dependent elements from our code and from UI components, in Wicket we can decide to provide different markup files for different locale settings. Just like standard markup files, by default localized markup files must be placed next to component's class and their file name must contain the locale's informations. In the following picture, CustomPanel comes with a standard (or default) markup file and with another one localized for German:<p class="paragraph"/><img border="0" class="center" src="../img/comp-with-markup-german.png"></img><p class="paragraph"/>When the current locale corresponds to German country (language code de), markup file CustomPanel_de.html will be used in place of the default one.<p class="paragraph"/><h3>Reading bundles with tag &#60;wicket:message&#62;</h3><p class="paragraph"/>String resources can be also retrieved directly from markup code using tag &#60;wicket:message&#62;. The key of the desired resource is specified with attribute key:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;wicket:message key=<span class="xml&#45;quote">"greetingMessage"</span>&#62;</span>message goes here<span class="xml&#45;tag">&#60;/wicket:message&#62;</span></pre></div><p class="paragraph"/>By default the resource value is not escaped for HTML entities. To do that use the <code>escape</code> attribute:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;wicket:message key=<span class="xml&#45;quote">"greetingMessage"</span> escape=<span class="xml&#45;quote">"true"</span>&#62;</span>message goes here<span class="xml&#45;tag">&#60;/wicket:message&#62;</span></pre></div><p class="paragraph"/>
<code>wicket:message</code> can be adopted also to localize the attributes of a tag. The name of the attribute and the resource key are expressed as a colon-separated value. In the following markup the content of attribute <code>value</code> will be replaced with the localized resource having 'key4value' as key:<p class="paragraph"/><div class="code"><pre>&#60;input type=<span class="java&#45;quote">"submit"</span> value=<span class="java&#45;quote">"Preview value"</span> wicket:message=<span class="java&#45;quote">"value:key4value"</span>/&#62;</pre></div><p class="paragraph"/>If we want to specify multiple attributes at once, we can separate them with a comma:<p class="paragraph"/><div class="code"><pre>&#60;input type=<span class="java&#45;quote">"submit"</span> value=<span class="java&#45;quote">"Preview value"</span> wicket:message=<span class="java&#45;quote">"value:key4value, title:key4title"</span>/&#62;</pre></div>



<h2 id="i18n_3">14.3 Bundles lookup algorithm</h2>
<p class="paragraph"/>As we hinted at the beginning of this chapter, by default Wicket provides a very flexible algorithm to locate the resource bundles available for a given component. In this paragraph we will learn how this default lookup algorithm works and which options it offers to manage our bundle files.<p class="paragraph"/><h3>Localizing pages and panels</h3><p class="paragraph"/>Similarly to application class, also component classes can have their own bundle files having as base name the class name of the related component and placed in the same package. So for example if class CustomPanel is a custom panel we created, we can provide it with a default bundle file called  CustomPanel.properties containing the textual resources used by this panel. This rule applies to page classes as well:<p class="paragraph"/><img border="0" class="center" src="../img/page-and-panel-bundle.png"></img><p class="paragraph"/>One fundamental thing to keep in mind when we work with these kinds of bundles is that the lookup algorithm gives priority to the bundles of the containers of the component that is requesting a localized resource. The more a container is higher in the hierarchy, the bigger is its priority over the other components. This mechanism was made to allow containers to overwrite resources used by children components. As a consequence the values inside the resource bundle of a page will have the priority over the other values with the same key defined in the bundles of children components.<p class="paragraph"/>To better grasp this concept let's consider the component hierarchy depicted in the following picture:<p class="paragraph"/><img border="0" class="center" src="../img/custom-panel-bundle.png"></img><p class="paragraph"/>If CustomPanel tries to retrieve the string resource having 'message' as key, it will get the value 'Wellcome!' and not the one defined inside its own bundle file.<p class="paragraph"/>The default message-lookup algorithm is not limited to component hierarchy but it also includes the class hierarchy of every component visited in the search strategy described so far. This makes bundle files inheritable, just like markup files. When the hierarchy of a container component is explored, any ancestor has the priority over children components. Consider for example the hierarchy in the following picture:<p class="paragraph"/><img border="0" class="center" src="../img/custom-panel-bundle2.png"></img><p class="paragraph"/>Similarly to the previous example, the bundle owned by CustomPanel is overwritten by the bundle of   page class BasePage (which has been inherited by CustomPage).<p class="paragraph"/><h3>Component-specific resources</h3><p class="paragraph"/>In order to make a resource specific for a given child component, we can prefix the message key with the id of the desired component. Consider for example the following code and bundle of a generic page:<p class="paragraph"/>Page code:<p class="paragraph"/><div class="code"><pre>add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"label"</span>,<span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"labelValue"</span>)));
add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"anotherLabel"</span>,<span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"labelValue"</span>)));</pre></div><p class="paragraph"/>Page bundle:<p class="paragraph"/><div class="code"><pre>labelValue=Default value
anotherLabel.labelValue=Value <span class="java&#45;keyword">for</span> anotherLabel</pre></div><p class="paragraph"/>Label with id anotherLabel will display the value 'Value for anotherLabel' while label label will display 'Default value'. In a similar fashion, parent containers can specify a resource for a nested child component prepending also its relative path (the path is dot-separated):<p class="paragraph"/>Page code:<p class="paragraph"/><div class="code"><pre>Form form = <span class="java&#45;keyword">new</span> Form(<span class="java&#45;quote">"form"</span>);
form.add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"anotherLabel"</span>,<span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"labelValue"</span>)));
add(form);</pre></div><p class="paragraph"/>Page bundle:<p class="paragraph"/><div class="code"><pre>labelValue=Default value
anotherLabel.labelValue=Value <span class="java&#45;keyword">for</span> anotherLabel
form.anotherLabel.labelValue=Value <span class="java&#45;keyword">for</span> anotherLabel inside form</pre></div><p class="paragraph"/>With the code and the bundle above, the label inside the form will display the value 'Value for anotherLabel inside form'.<p class="paragraph"/><h3>Package bundles</h3><p class="paragraph"/>If no one of the previous steps can find a resource for the given key, the algorithm will look for package bundles. These bundles have <code>wicket-package</code> as base name and they can be placed in one of the package of our application:<p class="paragraph"/><img border="0" class="center" src="../img/package-bundles.png"></img><p class="paragraph"/>Packages are traversed starting from the one containing the component requesting for a resource and going up to the root package.<p class="paragraph"/><h3>Bundles for feedback messages</h3><p class="paragraph"/>The algorithm described so far applies to feedback messages as well. In case of validation errors, the component that has caused the error will be considered as the component which the string resource is relative to. Furthermore, just like application class and components, validators can have their own bundles placed next to their class and having as base name their class name. This allows us to distribute validators along with the messages they use to report errors:<p class="paragraph"/><img border="0" class="center" src="../img/validator-with-bundle.png"></img><p class="paragraph"/>Validator's resource bundles have the lowest priority in the lookup algorithm. They can be overwritten by resource bundles of components, packages and application class.<p class="paragraph"/><h3>Extending the default lookup algorithm</h3><p class="paragraph"/>Wicket implements the default lookup algorithm using the strategy pattern1. The concrete strategies are abstracted with the interface <code>org.apache.wicket.resource.loader.IStringResourceLoader</code>. By default Wicket uses the following implementations of <code>IStringResourceLoader</code> (sorted by execution order):
<ol>
<li><strong class="bold">ComponentStringResourceLoader:</strong> implements most of the default algorithm. It searches for a given resource across bundles from the container hierarchy, from class hierarchy and from the given component.</li>
<li><strong class="bold">PackageStringResourceLoader:</strong> searches into package bundles.</li>
<li><strong class="bold">ClassStringResourceLoader:</strong> searches into bundles of a given class. By default the target class is the application class.</li>
<li><strong class="bold">ValidatorStringResourceLoader:</strong> searches for resources into validator's bundles. A list of validators is provided by the form component that failed validation.</li>
<li><strong class="bold">InitializerStringResourceLoader:</strong> this resource allows internationalization to interact with the initialization mechanism of the framework that will be illustrated in paragraph 15.4.</li>
</ol><p class="paragraph"/>Developer can customize lookup algorithm removing default resource loaders or adding custom implementations to the list of the resource loaders in use. This task can be accomplished using method getStringResourceLoaders of setting interface <code>org.apache.wicket.settings.IResourceSettings</code>:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">public</span> void init()
&#123;
  <span class="java&#45;keyword">super</span>.init();
  //retrieve IResourceSettings and then the list of resource loaders
  List&#60;IStringResourceLoader&#62; resourceLoaders = getResourceSettings(). 
                                                getStringResourceLoaders();
  //customize the list...</pre></div>



<h2 id="i18n_4">14.4 Localization of component's choices</h2>
<p class="paragraph"/>Components that inherit from <code>AbstractChoice</code> (such as <code>DropDownChoice</code>, <code>CheckBoxMultipleChoice</code> and <code>RadioChoice</code>) must override method <code>localizeDisplayValues</code> and make it return true to localize the values displayed for their choices. By default this method return false so values are displayed as they are. Once localization is activated we can use display values as key for our localized string resources. In project LocalizedChoicesExample we have a drop-down list that displays four colors (green, red, blue, and yellow) which are localized in three languages (English, German and Italian). The current locale can be changed with another drop-down menu (in a similar fashion to project <code>LocalizedGreetings</code>). The code of the home page and the relative bundles are the following:<p class="paragraph"/>Java code:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> HomePage(<span class="java&#45;keyword">final</span> PageParameters parameters) &#123;
	<span class="java&#45;keyword">super</span>(parameters);<p class="paragraph"/>	List&#60;Locale&#62; locales = Arrays.asList(Locale.ENGLISH, Locale.ITALIAN, Locale.GERMAN);
	List&#60;<span class="java&#45;object">String</span>&#62; colors = Arrays.asList(<span class="java&#45;quote">"green"</span>, <span class="java&#45;quote">"red"</span>, <span class="java&#45;quote">"blue"</span>, <span class="java&#45;quote">"yellow"</span>);<p class="paragraph"/>	<span class="java&#45;keyword">final</span> DropDownChoice&#60;Locale&#62; changeLocale = <span class="java&#45;keyword">new</span> DropDownChoice&#60;Locale&#62;(<span class="java&#45;quote">"changeLocale"</span>, 
                                                    <span class="java&#45;keyword">new</span> Model&#60;Locale&#62;(), locales);<p class="paragraph"/>	StatelessForm form = <span class="java&#45;keyword">new</span> StatelessForm(<span class="java&#45;quote">"form"</span>)&#123;
		@Override
		<span class="java&#45;keyword">protected</span> void onSubmit() &#123;
			Session.get().setLocale(changeLocale.getModelObject());
		&#125;
	&#125;;<p class="paragraph"/>	DropDownChoice&#60;<span class="java&#45;object">String</span>&#62; selectColor = <span class="java&#45;keyword">new</span> DropDownChoice&#60;<span class="java&#45;object">String</span>&#62;(<span class="java&#45;quote">"selectColor"</span>, <span class="java&#45;keyword">new</span> 
                                                            Model&#60;<span class="java&#45;object">String</span>&#62;(), colors)&#123;
		@Override
		<span class="java&#45;keyword">protected</span> <span class="java&#45;object">boolean</span> localizeDisplayValues() &#123;
			<span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span>;
		&#125;
	&#125;;<p class="paragraph"/>	form.add(selectColor);
	add(form.add(changeLocale));
    &#125;</pre></div><p class="paragraph"/>Default bundle (English):<p class="paragraph"/><div class="code"><pre>selectColor.<span class="java&#45;keyword">null</span>=Select a color
green=Green
red=Red
blue=Blue
yellow=Yellow</pre></div><p class="paragraph"/>German bundle:<p class="paragraph"/><div class="code"><pre>selectColor.<span class="java&#45;keyword">null</span>=Wahlen sie eine farbe
green=Grun
red=Rot
blue=Blau
yellow=Gelb</pre></div><p class="paragraph"/>Italian bundle:<p class="paragraph"/><div class="code"><pre>selectColor.<span class="java&#45;keyword">null</span>=Scegli un colore
green=Verde
red=Rosso
blue=Blu
yellow=Giallo</pre></div><p class="paragraph"/>Along with the localized versions of colors names, in the bundles above we can also find a custom value for the placeholder text (‚ÄúChose one ‚Äù) used for null value. The resource key for this resource is 'null' or '&#60;component id&#62;.null' if we want to make it component-specific.


<h2 id="i18n_5">14.5 Internationalization and Models</h2>
<p class="paragraph"/>Internationalization is another good chance to taste the power of models. Wicket provides two built-in models to better integrate our components with string resources: they are ResourceModel and StringResourceModel.<p class="paragraph"/><h3>ResourceModel</h3><p class="paragraph"/>Model <code>org.apache.wicket.model.ResourceModel</code> acts just like the read-only model we have implemented in paragraph 12.3.4. It simply retrieves a string resource corresponding to a given key:<p class="paragraph"/><div class="code"><pre>//build a ResourceModel <span class="java&#45;keyword">for</span> key 'greetingMessage'
<span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"greetingMessage"</span>);</pre></div><p class="paragraph"/>We can also specify a default value to use if the requested resource is not found:<p class="paragraph"/><div class="code"><pre>//build a ResourceModel with a <span class="java&#45;keyword">default</span> value
<span class="java&#45;keyword">new</span> ResourceModel(<span class="java&#45;quote">"notExistingResource"</span>, <span class="java&#45;quote">"Resource not found."</span>);</pre></div><p class="paragraph"/><h3>StringResourceModel</h3><p class="paragraph"/>Model <code>org.apache.wicket.model.StringResourceModel</code> allows to work with complex and dynamic string resources containing parameters and property expressions. The basic constructor of this model takes in input a resource key and another model. This further model can be used by both the key and the related resource to specify dynamic values with property expressions. For example let's say that we are working on an e-commerce site which has a page where users can see an overview of their orders. To handle the state of user's orders we will use the following bean and enum (the code is from project StringResourceModelExample):<p class="paragraph"/>Bean:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> class Order <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>	<span class="java&#45;keyword">private</span> Date orderDate;
	<span class="java&#45;keyword">private</span> ORDER_STATUS status;<p class="paragraph"/>	<span class="java&#45;keyword">public</span> Order(Date orderDate, ORDER_STATUS status) &#123;
		<span class="java&#45;keyword">super</span>();
		<span class="java&#45;keyword">this</span>.orderDate = orderDate;
		<span class="java&#45;keyword">this</span>.status = status;
	&#125;
	//Getters and setters <span class="java&#45;keyword">for</span> <span class="java&#45;keyword">private</span> fields
&#125;</pre></div><p class="paragraph"/>Enum:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> enum ORDER_STATUS &#123;<p class="paragraph"/>	PAYMENT_ACCEPTED(0),
	IN_PROGRESS(1),
	SHIPPING(2),
	DELIVERED(3);<p class="paragraph"/>	<span class="java&#45;keyword">private</span> <span class="java&#45;object">int</span> code;
	//Getters and setters <span class="java&#45;keyword">for</span> <span class="java&#45;keyword">private</span> fields	
&#125;</pre></div><p class="paragraph"/>Now what we want to do in this page is to print a simple label which displays the status of an order and the date on  which the order has been submitted. All the informations about the order will be passed to a StringResourceModel with a model containing the bean Order. The bundle in use contains the following key/value pairs:<p class="paragraph"/><div class="code"><pre>orderStatus.0=Your payment submitted on $&#123;orderDate&#125; has been accepted.
orderStatus.1=Your order submitted on $&#123;orderDate&#125; is in progress.
orderStatus.2=Your order submitted on $&#123;orderDate&#125; has been shipped.
orderStatus.3=Your order submitted on $&#123;orderDate&#125; has been delivered.</pre></div><p class="paragraph"/>The values above contain a property expression (${orderDate}) that will be evaluated on the data object of the model. The same technique can be applied to the resource key in order to load the right resource according to the state of the order:<p class="paragraph"/><div class="code"><pre>Order order = <span class="java&#45;keyword">new</span> Order(<span class="java&#45;keyword">new</span> Date(), ORDER_STATUS.IN_PROGRESS);
add(<span class="java&#45;keyword">new</span> Label(<span class="java&#45;quote">"orderStatus"</span>, <span class="java&#45;keyword">new</span> StringResourceModel(<span class="java&#45;quote">"orderStatus.$&#123;status.code&#125;"</span>, Model.of(order))));</pre></div><p class="paragraph"/>As we can see in the code above also the key contains a property expression (${status.code}) which makes its value dynamic. In this way the state of an object (an Order in our example) can determinate which resource will be loaded by StringResourceModel. If we don't use properties expressions we can provide a null value as model and in this case StringResourceModel will behave exactly as a ResourceModel. StringResourceModel supports also the same parameter substitution used by standard class java.text.MessageFormat. Parameters can be generic objects but if we use a model as parameter, StringResourceModel will use the data object inside it as actual value (it will call getObject on the model). Parameters are passed to constructor as a vararg argument. Here is an example of usage of parameter substitution:<p class="paragraph"/>Java code:<p class="paragraph"/><div class="code"><pre>PropertyModel propertyModel = <span class="java&#45;keyword">new</span> PropertyModel&#60;Order&#62;(order, <span class="java&#45;quote">"orderDate"</span>);
//build a string model with two parameters: a property model and an integer value
StringResourceModel srm = <span class="java&#45;keyword">new</span> StringResourceModel(<span class="java&#45;quote">"orderStatus.delay"</span>, <span class="java&#45;keyword">null</span>, propertyModel, 3);</pre></div><p class="paragraph"/>Bundle:<p class="paragraph"/><div class="code"><pre>orderStatus.delay=Your order submitted on $&#123;0&#125; has been delayed by &#123;1&#125; days.</pre></div><p class="paragraph"/>One further parameter we can specify when we build a StringResourceModel is the component that must be used by the lookup algorithm. Normally this parameter is not relevant, but if we need to use a particular bundle owned by a component not considered by the algorithm, we can specify this component as second parameter. If we pass all possible parameters to StringResourceModel's constructor we obtain something like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> StringResourceModel(<span class="java&#45;quote">"myKey"</span>, myComponent, myModel, param1, param2, param3,...);</pre></div>


<h2 id="i18n_6">14.6 Summary</h2>
<p class="paragraph"/>Internationalization is a mandatory step if we want to take our applications (and our business!) abroad. Choosing the right strategy to manage our localized resources is fundamental to avoid to make a mess of them. In this chapter we have explored the built-in support for localization provided by Wicket, and we have learnt which solutions it offers to manage resource bundles. In the final part of the chapter we have seen how to localize the options displayed by a component (such as DropDownChoice or RadioChoice) and we also introduced two new models specifically designed to localize our components without introducing in their code any detail about internationalization.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/repeaters.html">&lt;&lt; <strong>13</strong><span>Displaying multiple items with repeaters</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/resources.html"><strong>15</strong><span>Resource management with Wicket</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
Copyright &copy; 2013-2015 ‚Äî <a href="http://www.apache.org/" target="_blank">The Apache Software Foundation</a> 
                      ‚Äî <b style="color:#E8590A !important;">(Generated on: 2015-04-10)</b>

    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
